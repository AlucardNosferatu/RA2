<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ares: BulletExt::ExtData Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ares</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_bullet_ext.html">BulletExt</a>      </li>
      <li class="navelem"><a class="el" href="class_bullet_ext_1_1_ext_data.html">ExtData</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<h1>BulletExt::ExtData Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="BulletExt::ExtData" --><!-- doxytag: inherits="Extension&lt; TT &gt;" -->
<p><code>#include &lt;src/Ext/Bullet/Body.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BulletExt::ExtData:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_bullet_ext_1_1_ext_data.png" usemap="#BulletExt::ExtData_map" alt=""/>
  <map id="BulletExt::ExtData_map" name="BulletExt::ExtData_map">
<area href="class_extension.html" alt="Extension&lt; TT &gt;" shape="rect" coords="0,0,109,24"/>
</map>
 </div></div>

<p><a href="class_bullet_ext_1_1_ext_data-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a114b58759747d8025c2d021b49798c40">ExtData</a> (const DWORD <a class="el" href="class_extension.html#a2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, <a class="el" href="class_bullet_ext.html#a0af4200a0e57e1989fd519e42863006c">TT</a> *const OwnerObject)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a5406e0026fe14446df603396dd70721c">~ExtData</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#aa058779eaf714f9857a10bcf86430be8">Size</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a7ff16d406691e8aaa4c1eea43fd847c6">DamageOccupants</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the entire PassThrough logic, checks &amp; damage.  <a href="#a7ff16d406691e8aaa4c1eea43fd847c6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a965c3aa6de653b8bb97e5c52c48cb2ef">InvalidatePointer</a> (void *ptr)</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SuperWeaponTypeClass *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#ad703e32e27c50e5ddf65f8e81f407e57">NukeSW</a></td></tr>
</table>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a114b58759747d8025c2d021b49798c40"></a><!-- doxytag: member="BulletExt::ExtData::ExtData" ref="a114b58759747d8025c2d021b49798c40" args="(const DWORD Canary, TT *const OwnerObject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BulletExt::ExtData::ExtData </td>
          <td>(</td>
          <td class="paramtype">const DWORD&#160;</td>
          <td class="paramname"><em>Canary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bullet_ext.html#a0af4200a0e57e1989fd519e42863006c">TT</a> *const&#160;</td>
          <td class="paramname"><em>OwnerObject</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                                   : <a class="code" href="class_extension.html#a3f8a8fd621ae648a99ab593e8d69681e">Extension</a>(<a class="code" href="class_extension.html#a2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, OwnerObject),
                        <a class="code" href="class_bullet_ext_1_1_ext_data.html#ad703e32e27c50e5ddf65f8e81f407e57">NukeSW</a> (NULL)
                        { };
</pre></div>
</div>
</div>
<a class="anchor" id="a5406e0026fe14446df603396dd70721c"></a><!-- doxytag: member="BulletExt::ExtData::~ExtData" ref="a5406e0026fe14446df603396dd70721c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual BulletExt::ExtData::~ExtData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                   {
                }
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a7ff16d406691e8aaa4c1eea43fd847c6"></a><!-- doxytag: member="BulletExt::ExtData::DamageOccupants" ref="a7ff16d406691e8aaa4c1eea43fd847c6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BulletExt::ExtData::DamageOccupants </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Does the entire PassThrough logic, checks &amp; damage. </p>
<p>This function determines whether the projectile should pass through the outter shell of a building and damage the occupants instead.</p>
<p>If so, it proceeds to damage the occupants, and then returns true. If the projectile did not pass through, and the building has to be damaged according to normal rules. the function returns false.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if the bullet passed through and the damage case was handled, otherwise false.</dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>02.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment">                                       {
        BulletClass* TheBullet = this-&gt;<a class="code" href="class_extension.html#a72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;

        <span class="keywordflow">if</span>(BuildingClass* Building = specific_cast&lt;BuildingClass *&gt; (TheBullet-&gt;Target)) { <span class="comment">// if that pointer is null, something went wrong</span>
                <a class="code" href="class_bullet_type_ext_1_1_ext_data.html">BulletTypeExt::ExtData</a>* TheBulletTypeExt = <a class="code" href="class_bullet_type_ext.html#a7dc0a4583e92987bd0b670ed627aef26">BulletTypeExt::ExtMap</a>.<a class="code" href="class_container.html#a90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(TheBullet-&gt;Type);
                <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* BuildingAresData = <a class="code" href="class_building_type_ext.html#a9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#a90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(Building-&gt;Type);

<span class="comment">/*</span>
<span class="comment">                Debug::Log(&quot;Bullet %s is about to damage occupants of %s: occupants #%d, UC.PT = %lf\n&quot;,</span>
<span class="comment">                        TheBullet-&gt;Type-&gt;ID, Building-&gt;Type-&gt;ID, Building-&gt;Occupants.Count, BuildingAresData-&gt;UCPassThrough);</span>
<span class="comment">*/</span>
                <span class="comment">// only work when UCPassThrough is set, as per community vote in thread #1392</span>
                <span class="keywordflow">if</span>(Building-&gt;Occupants.Count &amp;&amp; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#a7d511060cdd7d539ac0af73660182497" title="How many percent of the shots pass through the building to the occupants? 0.0 = 0%, 1.0 = 100%; Defaults to 0.0.">UCPassThrough</a>) {
                        Debug::Log(<span class="stringliteral">&quot;SubjToTrenches = %d\n&quot;</span>, TheBulletTypeExt-&gt;<a class="code" href="class_bullet_type_ext_1_1_ext_data.html#aa835c54683462d48ef5321a0aefb09ed">SubjectToTrenches</a>);
                        <span class="comment">// test for !SubjectToTrenches because being SubjectToTrenches means &quot;we&#39;re getting stopped by trenches&quot;.</span>
                        <span class="keywordflow">if</span>(!TheBulletTypeExt-&gt;<a class="code" href="class_bullet_type_ext_1_1_ext_data.html#aa835c54683462d48ef5321a0aefb09ed">SubjectToTrenches</a>
                                || ((ScenarioClass::Instance-&gt;Random.RandomRanged(0, 99) / 100.0) &lt; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#a7d511060cdd7d539ac0af73660182497" title="How many percent of the shots pass through the building to the occupants? 0.0 = 0%, 1.0 = 100%; Defaults to 0.0.">UCPassThrough</a>)) {
                                <span class="keywordtype">int</span> poorBastard = ScenarioClass::Instance-&gt;Random.RandomRanged(0, Building-&gt;Occupants.Count - 1); <span class="comment">// which Occupant is getting it?</span>
                                Debug::Log(<span class="stringliteral">&quot;Poor Bastard #%d\n&quot;</span>, poorBastard);
                                <span class="keywordflow">if</span>(BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#a8d80d9952d5abd71318d3232bdd89c50" title="Chance of an occupant getting killed instantly when a bullet passes through. 0.0 = 0%...">UCFatalRate</a>
                                        &amp;&amp; ((ScenarioClass::Instance-&gt;Random.RandomRanged(0, 99) / 100.0) &lt; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#a8d80d9952d5abd71318d3232bdd89c50" title="Chance of an occupant getting killed instantly when a bullet passes through. 0.0 = 0%...">UCFatalRate</a>)) {
                                        Debug::Log(<span class="stringliteral">&quot;Fatal hit!\n&quot;</span>);
                                        <span class="comment">// fatal hit</span>
                                        Building-&gt;Occupants[poorBastard]-&gt;Destroyed(TheBullet-&gt;Owner);
                                        Building-&gt;Occupants[poorBastard]-&gt;UnInit();
                                        <span class="comment">// don&#39;t separate these two lines - poor guy&#39;s already ~dtor&#39;d, but his pointer is still dangling from the vector</span>
                                        Building-&gt;Occupants.RemoveItem(poorBastard);
                                        Building-&gt;UpdateThreatInCell(Building-&gt;GetCell());
                                } <span class="keywordflow">else</span> {
                                        <span class="comment">/* ReceiveDamage args:</span>
<span class="comment">                                        virtual eDamageState ReceiveDamage(int* pDamage, int DistanceFromEpicenter, WarheadTypeClass* pWH,</span>
<span class="comment">                                                ObjectClass* Attacker, bool IgnoreDefenses, bool PreventPassengerEscape, HouseClass* pAttackingHouse) R0;</span>
<span class="comment">                                                where</span>
<span class="comment">                                                DistanceFromEpicenter -&gt; used for CellSpread/PercentAtMax</span>
<span class="comment">                                                IgnoreDefenses -&gt; ignore Immune=yes</span>
<span class="comment">                                        */</span>

                                        <span class="comment">// just a flesh wound</span>
                                        Debug::Log(<span class="stringliteral">&quot;Flesh wound - health(%d) * UCDmgMult(%lf)\n&quot;</span>, TheBullet-&gt;Health, BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#aa25b97eb3687610a26935029f48610e9" title="How many percent of normal damage are applied if an occupant is hit when a bullet passes through...">UCDamageMultiplier</a>);
                                        <span class="comment">// Bullet-&gt;Health is the damage it delivers (go Westwood)</span>
                                        <span class="keywordtype">int</span> adjustedDamage = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (ceil(TheBullet-&gt;Health * BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#aa25b97eb3687610a26935029f48610e9" title="How many percent of normal damage are applied if an occupant is hit when a bullet passes through...">UCDamageMultiplier</a>));
                                        Debug::Log(<span class="stringliteral">&quot;Adjusted damage = %d\n&quot;</span>, adjustedDamage);
                                        <span class="keywordtype">int</span> result = Building-&gt;Occupants[poorBastard]-&gt;ReceiveDamage(&amp;adjustedDamage, 0, TheBullet-&gt;WH,
                                                                TheBullet-&gt;Owner, <span class="keyword">false</span>, <span class="keyword">true</span>, TheBullet-&gt;GetOwningHouse());
                                        Debug::Log(<span class="stringliteral">&quot;Received damage, %d\n&quot;</span>, result);
                                }

                                <span class="comment">// BuildingAresData is for the BuildingType for some reason, so we need a new Ext var</span>
                                <a class="code" href="class_building_ext_1_1_ext_data.html">BuildingExt::ExtData</a>* SpecificBuildingExt = <a class="code" href="class_building_ext.html#abae25aca766faa296092dea1dc69cff7">BuildingExt::ExtMap</a>.<a class="code" href="class_container.html#a90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(Building);
                                <span class="comment">// if the last occupant was killed and this building was raided, it needs to be returned to its owner. (Bug #700)</span>
                                SpecificBuildingExt-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#a35389a02d691eda3df45bb34487bd967" title="Checks if the building is empty but still marked as raided, and returns the building to its previous ...">evalRaidStatus</a>();
                                <span class="keywordflow">return</span> <span class="keyword">true</span>;
                        } <span class="keywordflow">else</span> {
                                <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c bullet was SubjectToTrenches=yes and UC.PassThrough did not apply</span>
                        }
                } <span class="keywordflow">else</span> {
                        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c either there were no occupants, or UC.PassThrough is set to 0</span>
                }
        } <span class="keywordflow">else</span> {
                <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c the building-pointer was NULL (which is concerning)</span>
        }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a965c3aa6de653b8bb97e5c52c48cb2ef"></a><!-- doxytag: member="BulletExt::ExtData::InvalidatePointer" ref="a965c3aa6de653b8bb97e5c52c48cb2ef" args="(void *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void BulletExt::ExtData::InvalidatePointer </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="class_extension.html#a9e6b2ac570eddadb2ca3c01668da88b8">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment">                                                          {
                }
</pre></div>
</div>
</div>
<a class="anchor" id="aa058779eaf714f9857a10bcf86430be8"></a><!-- doxytag: member="BulletExt::ExtData::Size" ref="aa058779eaf714f9857a10bcf86430be8" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual size_t BulletExt::ExtData::Size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="class_extension.html#a44ddedd12613b24b7b03d21982782047">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*this); };
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ad703e32e27c50e5ddf65f8e81f407e57"></a><!-- doxytag: member="BulletExt::ExtData::NukeSW" ref="ad703e32e27c50e5ddf65f8e81f407e57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SuperWeaponTypeClass* <a class="el" href="class_bullet_ext_1_1_ext_data.html#ad703e32e27c50e5ddf65f8e81f407e57">BulletExt::ExtData::NukeSW</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/Ext/Bullet/<a class="el" href="_bullet_2_body_8h.html">Body.h</a></li>
<li>src/Ext/Bullet/<a class="el" href="_bullet_2_body_8cpp.html">Body.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 17 2011 23:42:32 for Ares by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
